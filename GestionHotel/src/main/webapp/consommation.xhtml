<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
 xmlns:h="http://xmlns.jcp.org/jsf/html"
 xmlns:p="http://primefaces.org/ui"
 xmlns:f="http://xmlns.jcp.org/jsf/core"
 xmlns:c="http://java.sun.com/jsp/jstl/core"
 xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
 
<h:head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
		<title>Hôtels</title>
</h:head>

<body>

<h:outputStylesheet name="css/bootstrap.css" />
<h:outputScript name="resources/js/bootstrap.js" />

<ui:include src="navbar.xhtml" />

<div class="container">

<div style="margin-top : 120px;">
</div>

<!-- Facture by Client and Hotel Selection -->
 	<div class="form-groupe">
 		<!-- Hotel Selection -->
 		<h:form id="formSelectHotel">
 		<h:outputLabel value="Hotel : "></h:outputLabel>
        	<h:selectOneMenu class="form-control" value="#{consommationBean.idHotel}">
            <f:ajax event="change" update=":formSelectClient" render=":formSelectClient " listener="#{consommationBean.selectHotel}" />
 			<f:selectItem itemLabel="" itemValue="" />
                    <c:forEach var="hotel" items="#{consommationBean.hotels}">
                    	<f:selectItem itemLabel="#{hotel.nom}" itemValue="#{hotel.id}" />
                    </c:forEach>
         	</h:selectOneMenu>
        </h:form>

 		<br></br>

	<!-- Client Selection -->
		<h:form id="formSelectClient">
 		<h:outputLabel value="Client : "></h:outputLabel>
               <h:selectOneMenu class="form-control" value="#{consommationBean.idClient}">
                      	<f:ajax event="change"  listener="#{consommationBean.selectClient}" />
 						<f:selectItem itemLabel="" itemValue="" />
                    <c:forEach var="client" items="#{consommationBean.clients}">
                        <f:selectItem itemLabel="#{client.nom} #{client.prenom}" itemValue="#{client.idPersonne}" />
                    </c:forEach>
               </h:selectOneMenu>
        </h:form>
 		
 		<br></br>
	</div><!-- form-groupe -->
	
<h2>Clients</h2>
  <h:form>
    <p:growl id="msgs" showDetail="true" />
 
    <p:panel style="margin-bottom:10px; padding : 15px;">

        <h:panelGrid columns="6" cellpadding="5">
            <p style="margin-right : 20px; font-size : 15px ; font-weight : bold;">Sélectionner un client</p>
            
            <p:outputLabel for="hotel" value="Hôtel : " />

	  		<p:selectOneMenu id="hotel" value="#{consommationBean.idHotel}" style="width:125px ; margin-right : 15px; margin-left : 15px;">
	 		    <p:ajax listener="#{consommationBean.getClientsByHotel2}" update="clientDropDown" />
	            <f:selectItems value="#{consommationBean.hotels}" var="h"
	                    itemLabel="#{h.nom}" itemValue="#{h.id}" />
	        </p:selectOneMenu>
 
            <p:outputLabel for="clientDropDown" value="Client : " />
            
            <p:selectOneMenu id="clientDropDown" value="#{consommationBean.client}" style="width:200px ; margin-right : 15px; margin-left : 15px;">
                <f:selectItem itemLabel="Selectionner un client" itemValue="" noSelectionOption="true" />
                <f:selectItems value="#{consommationBean.clientsByHotel}" var="c"
                	itemLabel="#{c.nom}" itemValue="#{c.idPersonne}" />
            </p:selectOneMenu>

            
            <p:commandButton value="Submit" update="clientDisplayed" actionListener="#{derp.herp}" icon="ui-icon-check" />
        </h:panelGrid>
 	
        <p:separator />
 		<p>Ici l'affichage du client sélectionné</p>
 		
 		<h:form id="clientDisplayed">
	    	<h:panelGrid columns="4" cellpadding="5">
		        <h:outputLabel for="displayClient" value="Client:" style="font-weight:bold" />
		        <h:outputText id="displayClient" value="#{consommationBean.client}" />
	    	</h:panelGrid>
		</h:form>
		
		
		 <ui:repeat value="#{consommationBean.clientsByHotel}" var="cbh">
              <p:panelGrid  columns="2">
            	<h:outputText value="Nom : "></h:outputText>		
				<h:inputText requiredMessage="obligatoire" required="true" value="#{consommationBean.nom}"></h:inputText>
              </p:panelGrid>
            </ui:repeat>
		
		
        ================================= Ajout client =================================
		<h:form id="formAjoutClient">
		        <p:messages id="msgs" />
		 
		            <p:outputLabel for="nomClient" value="Nom :" />
		            <p:inputText id="nomClient" value="#{consommationBean.nom}" required="true" label="NomClient">
		                <f:validateLength minimum="2" />
		            </p:inputText>
		            <p:message for="nomClient" display="icon" />
		 
		            <p:outputLabel for="prenomClient" value="Prénom :" />
		            <p:inputText id="prenomClient" value="#{consommationBean.prenomClient}" label="prenom" required="true">
		                <f:validateLength minimum="2" />
		                <p:ajax update="msgPrenom" event="keyup" />
		            </p:inputText>
		            <p:message for="prenomClient" id="msgPrenom" display="icon" />
		            
		            <p:outputLabel for="rue" value="Rue :" />
		            <p:inputText id="rue" value="#{consommationBean.rue}" required="true" label="Nom">
		                <f:validateLength minimum="2" />
		            </p:inputText>
		            <p:message for="rue" display="icon" />
		            
		            <p:outputLabel for="codePostal" value="Code postal :" />
		            <p:inputText id="codePostal" value="#{consommationBean.codePostal}" required="true" label="Nom">
		                <f:validateLength minimum="2" />
		            </p:inputText>
		            <p:message for="codePostal" display="icon" />
		            
		            <p:outputLabel for="ville" value="Ville :" />
		            <p:inputText id="ville" value="#{consommationBean.ville}" required="true" label="ville">
		                <f:validateLength minimum="2" />
		            </p:inputText>
		            <p:message for="rue" display="icon" />
		            
		            <p:outputLabel for="pays" value="Pays :" />
		            <p:inputText id="pays" value="#{consommationBean.pays}" required="true" label="pays">
		                <f:validateLength minimum="2" />
		            </p:inputText>
		            <p:message for="pays" display="icon" />
		            
		            
		            <p:commandButton value="Save" update="formAjoutClient" actionListener="#{consommationBean.addClient}" icon="ui-icon-check" />
	
		</h:form>
       
    </p:panel>
</h:form>

<div style="margin-top : 120px;">
	
</div>

<h2 style="margin-bottom : 30px;">Liste des produits en stock de l'hôtel ...</h2>

<div class="row">
<div class="col-sm-6">
<h:form id="ProduitsStock">
    <p:dataTable id="tbl" var="p" value="#{consommationBean.produits}"
                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                 paginator="true" rows="10" style="margin-bottom:20px">
 
        <p:column>
            <f:facet name="header">
                <h:outputText value="Nom" />
            </f:facet>
            <h:outputText value="#{p.nom}" />
        </p:column>
 
        <p:column>
            <f:facet name="header">
                <h:outputText value="Quantité"/>
            </f:facet>
            <h:outputText value="#{p.quantite}" />
        </p:column>
 
        <p:column>
            <f:facet name="header">
                <h:outputText value="Coût d'achat" />
            </f:facet>
            <h:outputText value="#{p.coutAchat}" />
        </p:column>
        
        <p:column>
            <f:facet name="header">
                <h:outputText value="Coût de vente" />
            </f:facet>
            <h:outputText value="#{p.coutVente}" />
        </p:column>
        
         <p:column>
            <f:facet name="header">
                <h:outputText value="Ajouter" />
            </f:facet>
            <p:commandButton value="Ajouter" update="produitAjoute" actionListener="#{consommationBean.addProduitToBasket(p)}" icon="ui-icon-check" />
        </p:column>
    </p:dataTable>
</h:form>
</div> <!-- Data exporter produit en stock -->

	<div class="col-sm-6">
		<p:panel>
			<p>Ici les produits qu'on ajoute</p>
			<h:form id="produitAjoute">
	   			 <h:panelGrid columns="3" cellpadding="5" styleClass="ui-grid">
	   			 		<h:outputText value="#{consommationBean.produit.getNom()}" />
	        			<p:spinner id="basic" value="#{consommationBean.quantityAdded}"/>
	 					<h:outputText id="ajaxSpinnerValue" value="#{spinnerView.number5}" style="padding-left: 10px;" size="1" />
	    		</h:panelGrid>
			
			<div class="row">
				<div class="col-sm-9">
				</div>
				<div class="col-sm-3">
					<p:commandButton value="Valider" action="#{consommationBean.Consommer}" update="ProduitsStock">
					</p:commandButton>
				</div>
			</div>
			</h:form>
		</p:panel>
	</div>
</div><!-- row -->
</div> <!-- Container -->

</body>

</html>